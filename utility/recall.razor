# Determine what character is using script.
if findtype 3922 'backpack' as 'mydagger'
    getlabel 'mydagger' 'daggerlabel'
    if 'blessed' in 'daggerlabel'
        dclick 'mydagger'
        wait 500
        target 'self'
        wait 350
        @setvar! 'lastserial' lasttarget
    endif
endif

if 'lastserial' = '0x64772'
    # CacheMine
    overhead "CacheMine Recall"
    hotkey 'Recall'
    wait 2100
    target 0x402C3F91
    
    # Enter Crew Fortress
    while not position 4052 937 9
        walk 'North'
        wait 150
    endwhile
    # Close first doors
    while findtype 1654 'ground' -1 -1 4 or findtype 1656 'ground' -1 -1 4
        dclicktype 1654 'ground'
        dclicktype 1656 'ground'
        wait 150
    endwhile
    # Move further into house
    while not position 4052 933 9
        walk 'North'
        wait 150
    endwhile
    # Close second doors
    while findtype 1654 'ground' -1 -1 4 or findtype 1656 'ground' -1 -1 4
        dclicktype 1654 'ground'
        dclicktype 1656 'ground'
        wait 150
    endwhile
    # Go to corner
    while not position 4054 933 9
        walk 'East'
        wait 150
    endwhile
    while not position 4054 937 9
        walk 'South'
        wait 150
    endwhile
elseif 'lastserial' = '0x22624'
    # CacheGhost
    overhead "CacheGhost Recall"
    hotkey 'Recall'
    wait 2100
    target 0x4BC96FFB
else
    overhead "Invalid"
endif


# Start party check
clearsysmsg 
say '[party'
wait 150
# Party Member Message
clearsysmsg
gumpresponse 20 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 21 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 22 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 23 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 24 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 25 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 26 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 27 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 28 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
clearsysmsg
gumpresponse 29 3527489586
waitforgump 3527489586
if insysmsg 'message will you send'
    # setup party member serial
    promptresponse 'Recalling'
endif
gumpclose 3527489586