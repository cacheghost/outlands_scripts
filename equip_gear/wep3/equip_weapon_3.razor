# If we havent set our weapon, set it.
if not varexist 'weapon_3'
    overhead '[Select Weapon 3]' 
    setvar! 'weapon_3'
endif

# Check if we are casting
if varexist 'weapon_3'
    # Look for weapon to equip
    if find 'weapon_3' 'backpack'
        # Weapon found in backpack.
        if findlayer self lefthand as 'myweapon'
            if 'myweapon' != 'weapon_3'
                # Weapon we are wearing isnt our weapon, change that.
                overhead '[Equip Weapon 3]' 55
                if targetexists any
                    #lift 'myweapon'
                    #drop 'backpack'
                    #lift 'weapon_3'
                    #drop self LeftHand
                    hotkey 'Undress Left Hand'
                    wait 500
                    dress 'weapon 3'
                else
                    dclick 'weapon_3'
                endif
            endif
        elseif findlayer self righthand as 'myweapon'
            if 'myweapon' != 'weapon_3'
                # Weapon we are wearing isnt our weapon, change that.
                overhead '[Equip Weapon 3]' 55
                if targetexists any
                    #lift 'myweapon'
                    #drop 'backpack'
                    #lift 'weapon_3'
                    #drop self RightHand
                    hotkey 'Undress Right Hand'
                    wait 500
                    dress 'weapon 3'
                else
                    dclick 'weapon_3'
                endif
            endif
        else
            # Not wearing weapon, equip from backpack
            overhead '[Equip Weapon 3]' 55
            if targetexists any
                #lift 'weapon_3'
                #drop self LeftHand
                dress 'weapon 3'
            else
                dclick 'weapon_3'
            endif
        endif
    else
        # We are not wearing the weapon, and its not in backpack. Unset variable
        if findlayer self lefthand as 'myweapon'
            if 'myweapon' != 'weapon_3'
                #overhead '[Unset Weapon 3]' 33
                #@unsetvar 'weapon_3'
            endif
        elseif findlayer self righthand as 'myweapon'
            if 'myweapon' != 'weapon_3'
                #overhead '[Unset Weapon 3]' 33
                #@unsetvar 'weapon_3'
            endif
        else
            #overhead '[Unset Weapon 3]' 33
            #@unsetvar 'weapon_3'
        endif
    endif
endif
script main